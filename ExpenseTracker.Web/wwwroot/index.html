<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Expense Tracker — Login / Register</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="./styles.css" />

</head>

<body>
    <main style="max-width:420px;margin:60px auto;">

        <!-- LOGIN PANEL -->
        <section id="login-panel" class="panel">
            <h2>Sign in</h2>
            <form id="form-login">
                <label>
                    Username
                    <input id="login-username" type="text" required />
                </label>
                <label>
                    Password
                    <input id="login-password" type="password" required />
                </label>
                <button type="submit">Sign in</button>
                <div id="login-msg" class="muted"></div>

                <p style="margin-top:18px;" class="muted">
                    Don’t have an account?
                    <span id="goto-register" class="toggle-link">Create one</span>
                </p>
            </form>
        </section>

        <!-- REGISTER PANEL -->
        <section id="register-panel" class="panel hidden">
            <h2>Create Account</h2>
            <form id="form-register">
                <label>
                    Username
                    <input id="reg-username" type="text" required />
                </label>
                <label>
                    Password
                    <input id="reg-password" type="password" required />
                </label>
                <button type="submit">Register</button>
                <div id="register-msg" class="muted"></div>

                <p style="margin-top:18px;" class="muted">
                    Already have an account?
                    <span id="goto-login" class="toggle-link">Sign in</span>
                </p>
            </form>
        </section>

    </main>

    <script src="app.js" defer></script>

    <script>
        (function () {
            const byId = id => document.getElementById(id);
            const show = id => byId(id).classList.remove('hidden');
            const hide = id => byId(id).classList.add('hidden');
            const setMsg = (id, text, err = false) => {
                const el = byId(id); el.textContent = text; el.className = err ? 'error' : 'muted';
            };

            // toggle
            byId('goto-register').onclick = () => {
                hide('login-panel');
                show('register-panel');
            };
            byId('goto-login').onclick = () => {
                hide('register-panel');
                show('login-panel');
            };

            // LOGIN
            byId('form-login').addEventListener('submit', async (e) => {
                e.preventDefault();
                setMsg('login-msg', 'Signing in...');
                try {
                    const username = byId('login-username').value.trim();
                    const password = byId('login-password').value;
                    const { token } = await authLogin({ username, password });
                    localStorage.setItem('jwt', token);
                    localStorage.setItem('currentUser', JSON.stringify(decodeJwt(token)));
                    location.href = '/dashboard.html';
                } catch (err) {
                    setMsg('Password is incorrect!', err.message || String(err), true);
                }
            });

            // REGISTER
            byId('form-register').addEventListener('submit', async (e) => {
                e.preventDefault();
                setMsg('register-msg', 'Creating account...');

                try {
                    const username = byId('reg-username').value.trim();
                    const password = byId('reg-password').value;

                    const result = await authRegister({ username, password });

                    setMsg('register-msg', 'Account created! You can now sign in.');

                    // Option A (simple): switch back to login
                    hide('register-panel');
                    show('login-panel');

                } catch (err) {
                    setMsg('register-msg', err.message || String(err), true);
                }
            });

        })();
    </script>

</body>
</html>
